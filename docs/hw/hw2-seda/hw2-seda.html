<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PSTAT100 - Background</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-H3YKZX4J88"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-H3YKZX4J88', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">PSTAT100</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Course syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../content.html" rel="" target="">
 <span class="menu-text">Materials</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#assignment-objectives" id="toc-assignment-objectives" class="nav-link active" data-scroll-target="#assignment-objectives">Assignment objectives</a></li>
  <li><a href="#import-and-assessment-of-datasets" id="toc-import-and-assessment-of-datasets" class="nav-link" data-scroll-target="#import-and-assessment-of-datasets">Import and assessment of datasets</a>
  <ul class="collapse">
  <li><a href="#test-score-data" id="toc-test-score-data" class="nav-link" data-scroll-target="#test-score-data">Test score data</a>
  <ul class="collapse">
  <li><a href="#question-1-interpreting-test-score-values" id="toc-question-1-interpreting-test-score-values" class="nav-link" data-scroll-target="#question-1-interpreting-test-score-values">Question 1: Interpreting test score values</a></li>
  </ul></li>
  <li><a href="#covariate-data" id="toc-covariate-data" class="nav-link" data-scroll-target="#covariate-data">Covariate data</a>
  <ul class="collapse">
  <li><a href="#question-2-data-semantics" id="toc-question-2-data-semantics" class="nav-link" data-scroll-target="#question-2-data-semantics">Question 2: Data semantics</a></li>
  <li><a href="#question-3-sample-sizes" id="toc-question-3-sample-sizes" class="nav-link" data-scroll-target="#question-3-sample-sizes">Question 3: Sample sizes</a></li>
  <li><a href="#question-4-sample-characteristics-and-scope-of-inference" id="toc-question-4-sample-characteristics-and-scope-of-inference" class="nav-link" data-scroll-target="#question-4-sample-characteristics-and-scope-of-inference">Question 4: Sample characteristics and scope of inference</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-tidying" id="toc-data-tidying" class="nav-link" data-scroll-target="#data-tidying">Data tidying</a>
  <ul class="collapse">
  <li><a href="#question-5-variable-names-of-interest" id="toc-question-5-variable-names-of-interest" class="nav-link" data-scroll-target="#question-5-variable-names-of-interest">Question 5: Variable names of interest</a></li>
  <li><a href="#question-6-slice-columns" id="toc-question-6-slice-columns" class="nav-link" data-scroll-target="#question-6-slice-columns">Question 6: Slice columns</a></li>
  <li><a href="#question-7-merge" id="toc-question-7-merge" class="nav-link" data-scroll-target="#question-7-merge">Question 7: Merge</a></li>
  <li><a href="#question-8-rename-and-reorder-columns" id="toc-question-8-rename-and-reorder-columns" class="nav-link" data-scroll-target="#question-8-rename-and-reorder-columns">Question 8: Rename and reorder columns</a></li>
  <li><a href="#question-9-pivot" id="toc-question-9-pivot" class="nav-link" data-scroll-target="#question-9-pivot">Question 9: Pivot</a></li>
  <li><a href="#question-10-sanity-check" id="toc-question-10-sanity-check" class="nav-link" data-scroll-target="#question-10-sanity-check">Question 10: Sanity check</a></li>
  <li><a href="#question-11-missing-values" id="toc-question-11-missing-values" class="nav-link" data-scroll-target="#question-11-missing-values">Question 11: Missing values</a></li>
  <li><a href="#question-12-missing-mechanism" id="toc-question-12-missing-mechanism" class="nav-link" data-scroll-target="#question-12-missing-mechanism">Question 12: Missing mechanism</a></li>
  </ul></li>
  <li><a href="#exploratory-graphics" id="toc-exploratory-graphics" class="nav-link" data-scroll-target="#exploratory-graphics">Exploratory graphics</a>
  <ul class="collapse">
  <li><a href="#gender-gaps-and-socioeconomic-factors" id="toc-gender-gaps-and-socioeconomic-factors" class="nav-link" data-scroll-target="#gender-gaps-and-socioeconomic-factors">Gender gaps and socioeconomic factors</a>
  <ul class="collapse">
  <li><a href="#question-13-relationships-by-grade-level" id="toc-question-13-relationships-by-grade-level" class="nav-link" data-scroll-target="#question-13-relationships-by-grade-level">Question 13: Relationships by grade level</a></li>
  <li><a href="#question-14-association-with-grade-level" id="toc-question-14-association-with-grade-level" class="nav-link" data-scroll-target="#question-14-association-with-grade-level">Question 14: Association with grade level</a></li>
  <li><a href="#question-15-aggregation-across-grade-levels" id="toc-question-15-aggregation-across-grade-levels" class="nav-link" data-scroll-target="#question-15-aggregation-across-grade-levels">Question 15: Aggregation across grade levels</a></li>
  <li><a href="#question-16-melt-aggregated-data-for-plotting" id="toc-question-16-melt-aggregated-data-for-plotting" class="nav-link" data-scroll-target="#question-16-melt-aggregated-data-for-plotting">Question 16: Melt aggregated data for plotting</a></li>
  <li><a href="#question-17-district-average-gaps" id="toc-question-17-district-average-gaps" class="nav-link" data-scroll-target="#question-17-district-average-gaps">Question 17: District average gaps</a></li>
  <li><a href="#question-18-proportion-of-districts-with-a-math-gap" id="toc-question-18-proportion-of-districts-with-a-math-gap" class="nav-link" data-scroll-target="#question-18-proportion-of-districts-with-a-math-gap">Question 18: Proportion of districts with a math gap</a></li>
  <li><a href="#question-19-statewide-averages" id="toc-question-19-statewide-averages" class="nav-link" data-scroll-target="#question-19-statewide-averages">Question 19: Statewide averages</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#communicating-results" id="toc-communicating-results" class="nav-link" data-scroll-target="#communicating-results">Communicating results</a>
  <ul class="collapse">
  <li><a href="#question-20-summary" id="toc-question-20-summary" class="nav-link" data-scroll-target="#question-20-summary">Question 20: Summary</a></li>
  </ul></li>
  <li><a href="#submission" id="toc-submission" class="nav-link" data-scroll-target="#submission">Submission</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Background</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Otter</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> otter</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>grader <span class="op">=</span> otter.Notebook(<span class="st">"hw2-seda.ipynb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># disable row limit for plotting</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>alt.data_transformers.disable_max_rows()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment to ensure graphics display with pdf export</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># alt.renderers.enable('mimetype')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Gender achievement gaps in education have been well-documented over the years – studies consistently find boys outperforming girls on math tests and girls outperforming boys on reading and language tests. A particularly controversial <a href="https://www.jstor.org/stable/1684489">article</a> was published in Science in 1980 arguing that this pattern was due to an ‘innate’ difference in ability (focusing on mathematics rather than on reading and language). Such views persisted in part because studying systematic patterns in achievement nationwide was a challenge due to differential testing standards across school districts and the general lack of availability of large-scale data.</p>
<p>It is only recently that data-driven research has begun to reveal socioeconomic drivers of achievement gaps. The <a href="https://edopportunity.org/">Standford Educational Data Archive</a> (SEDA), a publicly available database on academic achievement and educational opportunity in U.S. schools, has supported this effort. The database is part of a broader initiave aiming to improve educational opportunity by enabling researchers and policymakers to identify systemic drivers of disparity.</p>
<blockquote class="blockquote">
<p>SEDA includes a range of detailed data on educational conditions, contexts, and outcomes in school districts and counties across the United States. It includes measures of academic achievement and achievement gaps for school districts and counties, as well as district-level measures of racial and socioeconomic composition, racial and socioeconomic segregation patterns, and other features of the schooling system.</p>
</blockquote>
<p>The database standardizes average test scores for schools 10,000 U.S. school districts relative to national standards to allow comparability between school districts and across grade levels and years. The test score data come from the U.S. Department of Education. In addition, multiple data sources (American Community Survey and Common Core of Data) are integrated to provide district-level socioeconomic and demographic information.</p>
<p>A <a href="https://cepa.stanford.edu/content/gender-achievement-gaps-us-school-districts">study of the SEDA data published in 2018</a> identified the following persistent patterns across grade levels 3 - 8 and school ears from 2008 through 2015: * a consistent reading and language achievement gap favoring girls; * <em>no</em> national math achievement gap on average; and * local math achievement gaps that depend on the socioeconomic conditions of school districts. You can read about the main findings of the study in this <a href="https://www.nytimes.com/interactive/2018/06/13/upshot/boys-girls-math-reading-tests.html">brief NY Times article</a>.</p>
<p>Below, we’ll work with selected portions of the database. The full datasets can be downloaded <a href="https://edopportunity.org/get-the-data/seda-archive-downloads/">here</a>.</p>
<section id="assignment-objectives" class="level2">
<h2 class="anchored" data-anchor-id="assignment-objectives">Assignment objectives</h2>
<p>In this assignment, you’ll explore achievement gaps in California school districts in 2018, reproducing the findings described <a href="https://www.nytimes.com/interactive/2018/06/13/upshot/boys-girls-math-reading-tests.html">in the article above</a> on a more local scale and with the most recent SEDA data. You’ll practice the following:</p>
<ul>
<li>review of data documentation</li>
<li>assessment of sampling design and scope of inference</li>
<li>data tidying operations
<ul>
<li>slicing and filtering</li>
<li>merging multiple data frames</li>
<li>pivoting tables</li>
<li>renaming and reordering variables</li>
</ul></li>
<li>constructing exploratory graphics and visualizing trends</li>
<li>data aggregations</li>
<li>narrative summary of exploratory analysis</li>
</ul>
</section>
<section id="import-and-assessment-of-datasets" class="level1">
<h1>Import and assessment of datasets</h1>
<p>You’ll work with test data and socioeconomic covariates aggregated to the school district level. These data are stored in two separate tables. Here you’ll examine them and review data documentation.</p>
<section id="test-score-data" class="level2">
<h2 class="anchored" data-anchor-id="test-score-data">Test score data</h2>
<p>The first few rows of the test data are shown below. The columns are:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Column name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sedalea</code></td>
<td>District ID</td>
</tr>
<tr class="even">
<td><code>grade</code></td>
<td>Grade level</td>
</tr>
<tr class="odd">
<td><code>stateabb</code></td>
<td>State abbreviation</td>
</tr>
<tr class="even">
<td><code>sedaleaname</code></td>
<td>District name</td>
</tr>
<tr class="odd">
<td><code>subject</code></td>
<td>Test subject</td>
</tr>
<tr class="even">
<td><code>cs_mn_...</code></td>
<td>Estimated mean test score</td>
</tr>
<tr class="odd">
<td><code>cs_mnse_...</code></td>
<td>Standard error for estimated mean test score</td>
</tr>
<tr class="even">
<td><code>totgyb_...</code></td>
<td>Number of individual tests used to estimate the mean score</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import seda data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ca_main <span class="op">=</span> pd.read_csv(<span class="st">'data/ca-main.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ca_cov <span class="op">=</span> pd.read_csv(<span class="st">'data/ca-cov.csv'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># preview test score data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>ca_main.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The test score means for each district are named <code>cs_mn_...</code> with an abbreviation indicating subgroup (such as mean score for all <code>cs_mean_all</code>, for boys <code>cs_mean_mal</code>, for white students <code>cs_mn_wht</code>, and so on). Notice that these are generally small-ish: decimal numbers between -0.5 and 0.5.</p>
<p>These means are <em>estimated</em> from a number of individual student tests and <em>standardized</em> relative to national averages. They represent the number of standard deviations by which a district mean differs from the national average. So, for instance, the value <code>cs_mn_all = 0.1</code> indicates that the district average is estimated to be 0.1 standard deviations greater than the national average on the corresponding test and at the corresponding grade level.</p>
<!-- BEGIN QUESTION -->
<section id="question-1-interpreting-test-score-values" class="level3">
<h3 class="anchored" data-anchor-id="question-1-interpreting-test-score-values">Question 1: Interpreting test score values</h3>
<p>Interpret the average math test score for all 4th grade students in Acton-Agua Dulce Unified School District (the first row of the dataset shown above).</p>
<p><em>Type your answer here, replacing this text.</em></p>
<!-- END QUESTION -->
</section>
</section>
<section id="covariate-data" class="level2">
<h2 class="anchored" data-anchor-id="covariate-data">Covariate data</h2>
<p>The first few rows of the covariate data are shown below. The column information is as follows:</p>
<table class="table">
<thead>
<tr class="header">
<th>Column name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sedalea</code></td>
<td>District ID</td>
</tr>
<tr class="even">
<td><code>grade</code></td>
<td>Grade level</td>
</tr>
<tr class="odd">
<td><code>sedaleanm</code></td>
<td>District name</td>
</tr>
<tr class="even">
<td><code>urban</code></td>
<td>Indicator: is the district in an urban locale?</td>
</tr>
<tr class="odd">
<td><code>suburb</code></td>
<td>Indicator: is the district in a suburban locale?</td>
</tr>
<tr class="even">
<td><code>town</code></td>
<td>Indicator: is the district in a town locale?</td>
</tr>
<tr class="odd">
<td><code>rural</code></td>
<td>Indicator: is the district in a rural locale?</td>
</tr>
<tr class="even">
<td><code>locale</code></td>
<td>Description of district locale</td>
</tr>
<tr class="odd">
<td>Remaining variables</td>
<td>Demographic and socioeconomic measures</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ca_cov.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will only be working with a handful of the demographic and socioeconomic measures, so you can put off getting acquainted with those until selecting a subset of variables.</p>
<!-- BEGIN QUESTION -->
<section id="question-2-data-semantics" class="level3">
<h3 class="anchored" data-anchor-id="question-2-data-semantics">Question 2: Data semantics</h3>
<p>In the non-public data, observational units are students – test scores are measured for each student. However, in the SEDA data you’ve imported, scores are <em>aggregated</em> to the district level by grade. Let’s regard estimated test score means for each grade as distinct variables, so that an observation consists in a set of estimated means for different grade levels and groups. In this view, what are the observational units in the test score dataset? Are they the same or different for the covariate dataset?</p>
<p><em>Type your answer here, replacing this text.</em></p>
<!-- END QUESTION -->
</section>
<section id="question-3-sample-sizes" class="level3">
<h3 class="anchored" data-anchor-id="question-3-sample-sizes">Question 3: Sample sizes</h3>
<p>How many observational units are in each dataset? Count the number of units in the test dataset and the number of units in the covariate dataset separately. Store the values as <code>ca_cov_units</code> and <code>ca_main_units</code>, respectively.</p>
<p>(<em>Hint</em>: use <code>.nunique()</code>.)</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ca_cov_units <span class="op">=</span> ...</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ca_main_units <span class="op">=</span> ...</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'units in covariate data: '</span>, ca_cov_units)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'units in test score data: '</span>, ca_main_units)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
</section>
<section id="question-4-sample-characteristics-and-scope-of-inference" class="level3">
<h3 class="anchored" data-anchor-id="question-4-sample-characteristics-and-scope-of-inference">Question 4: Sample characteristics and scope of inference</h3>
<p>Answer the questions below about the sampling design in a short paragraph. You do not need to dig through any data documentation in order to resolve these questions.</p>
<ul>
<li><ol type="i">
<li>What is the relevant population for the datasets you’ve imported?</li>
</ol></li>
<li><ol start="2" type="i">
<li>About what proportion (to within 0.1) of the population is captured in the sample? (<em>Hint</em>: have a look at <a href="https://www.cde.ca.gov/ds/sd/cb/ceffingertipfacts.asp">this website</a>.)</li>
</ol></li>
<li><ol start="3" type="i">
<li>Considering that the sampling frame is not identified clearly, what kind of dataset do you suspect this is (<em>e.g.</em>, administrative, data from a ‘typical sample’, census, etc.)?<br>
</li>
</ol></li>
<li><ol start="4" type="i">
<li>In light of your description of the sample characteristics, what is the scope of inference for this dataset?</li>
</ol></li>
</ul>
<p><em>Type your answer here, replacing this text.</em></p>
<!-- END QUESTION -->
</section>
</section>
</section>
<section id="data-tidying" class="level1">
<h1>Data tidying</h1>
<p>Since you’ve already had some guided practice doing this in previous assignments, you’ll be left to fill in a little bit more of the details on your own in this assignment. You’ll work with the following variables from each dataset:</p>
<ul>
<li><strong>Test score data</strong>
<ul>
<li>District ID</li>
<li>District name</li>
<li>Grade</li>
<li>Test subject</li>
<li>Estimated male-female gap</li>
</ul></li>
<li><strong>Covariate data</strong>
<ul>
<li>District ID</li>
<li>Locale</li>
<li>Grade</li>
<li>Socioeconomic status (all demographic groups)</li>
<li>Log median income (all demographic groups)</li>
<li>Poverty rate (all demographic groups)</li>
<li>Unemployment rate (all demographic groups)</li>
<li>SNAP benefit receipt rate (all demographic groups)</li>
</ul></li>
</ul>
<section id="question-5-variable-names-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="question-5-variable-names-of-interest">Question 5: Variable names of interest</h3>
<p>Download the codebooks by opening the ‘data’ directory from your Jupyter Lab file navigator and downloading the codebook files. Identify the variables listed above, and store the column names in lists named <code>main_vars</code> and <code>cov_vars</code>.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store variable names of interest</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>main_vars <span class="op">=</span> ...</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>cov_vars <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-6-slice-columns" class="level3">
<h3 class="anchored" data-anchor-id="question-6-slice-columns">Question 6: Slice columns</h3>
<p>Use your result from above to slice the columns of interest from the covariate and test score data. Store the resulting data frames as <code>main_sub</code> and <code>cov_sub</code> (for ‘subset’).</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># slice columns to select variables of interest</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>main_sub <span class="op">=</span> ...</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>cov_sub <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q6"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next step you’ll merge the covariate data with the test score data. In order to do this, you can use the <code>pd.merge(A, B, how = ..., on = SHARED_COLS)</code> function, which will match the rows of <code>A</code> and <code>B</code> based on the shared columns <code>SHARED_COLS</code>. If <code>how = 'left'</code>, then only rows in <code>A</code> will be retained in the output (so <code>B</code> will be merged <em>to</em> <code>A</code>); conversely, if <code>how = 'right'</code>, then only rows in <code>B</code> will be retained in the output (so <code>A</code> will be merged <em>to</em> <code>B</code>).</p>
<p>A simple example of the use of <code>pd.merge</code> is illustrated below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># toy data frames</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> pd.DataFrame(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'shared_col'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'x1'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'x2'</span>: [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> pd.DataFrame(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'shared_col'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>], </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'y1'</span>: [<span class="dv">7</span>, <span class="dv">8</span>]}</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, if <code>A</code> and <code>B</code> are merged retaining the rows in <code>A</code>, notice that a missing value is input because <code>B</code> has no row where the shared column (on which the merging is done) has value <code>c</code>. In other words, the third row of <code>A</code> has no match in <code>B</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># left join</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pd.merge(A, B, how <span class="op">=</span> <span class="st">'left'</span>, on <span class="op">=</span> <span class="st">'shared_col'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the direction of merging is reversed, and the row structure of <code>B</code> is dominant, then the third row of <code>A</code> is dropped altogether because it has no match in <code>B</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># right join</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>pd.merge(A, B, how <span class="op">=</span> <span class="st">'right'</span>, on <span class="op">=</span> <span class="st">'shared_col'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-7-merge" class="level3">
<h3 class="anchored" data-anchor-id="question-7-merge">Question 7: Merge</h3>
<p>Merge the covariate and test score data on both the <strong><em>district ID</em></strong> and <strong><em>grade level</em></strong> columns, and retain only the columns from the test score data (meaning, merge the covariate data <em>to</em> the test score data). Store the resulting data frame as <code>rawdata</code> and print the first four rows.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge covariates with gap data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>rawdata <span class="op">=</span> ...</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print first four rows</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-8-rename-and-reorder-columns" class="level3">
<h3 class="anchored" data-anchor-id="question-8-rename-and-reorder-columns">Question 8: Rename and reorder columns</h3>
<p>Now rename and rearrange the columns of <code>rawdata</code> so that they appear in the following order and with the following names:</p>
<ul>
<li>District ID, District, Locale, log(Median income), Poverty rate, Unemployment rate, SNAP rate, Socioeconomic index, Grade, Subject, Gender gap</li>
</ul>
<p>Store the resulting data frame as <code>rawdata_mod1</code> and print the first four rows.</p>
<p>(<em>Hint</em>: first define a dictionary to map the old names to the new ones; then create a list of the new names specified in the desired order; then use <code>.rename()</code> and <code>.loc[]</code>. You can follow the renaming steps in HW1 as an example if needed.)</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define dictionary mapping for renaming columns</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># specify order of columns</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rename and reorder</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print first four rows</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-9-pivot" class="level3">
<h3 class="anchored" data-anchor-id="question-9-pivot">Question 9: Pivot</h3>
<p>Notice that the Gender gap column contains the values of two variables: the gap in estimated mean test scores for math tests, and the gap in estimated mean test scores for reading and language tests. To put the data in tidy format, use <code>.pivot</code> and <code>.rename()</code> to pivot the table so that the gender gap column is spread into two columns named <code>Math gap</code> and <code>Reading gap</code>. Store the result as <code>seda_data</code> and print the first four rows.</p>
<p><em>Hint</em>: to avoid unweildy column indexing, make sure you specify a <code>values = ...</code> argument when using <code>.pivot()</code>. Doing so will result in the column index being named <code>Subject</code>; remove this name in your solution.</p>
<p><em>Aside</em>: an alternative solution is to manipulate the indices and use <code>.unstack()</code>, but this method will produce a dataframe with hierarchical column indexing (you’ll see) in which <code>Subject</code> is retained as a lower-level index; this will need to be collapsed in order to rename the columns as instructed using <code>MultiIndex.droplevel()</code> or similar.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot to unstack gender gap (fixing tidy issue: multiple variables in one column)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print first four rows</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q9"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your final dataset should match the dataframe below. You can use this to check your answer and revise any portions above that lead to different results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># intended result</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>data_reference <span class="op">=</span> pd.read_csv(<span class="st">'data/tidy-seda-check.csv'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>data_reference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-10-sanity-check" class="level3">
<h3 class="anchored" data-anchor-id="question-10-sanity-check">Question 10: Sanity check</h3>
<p>Ensure that your tidying did not inadvertently drop any observations: count the number of units in <code>seda_data</code>. Does this match the number of units represented in the original test score data <code>ca_main</code>? Store these values as <code>data_units</code> and <code>ca_main_units</code>, respectively.</p>
<p>(<em>Hint</em>: use <code>.nunique()</code>.)</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of districts in tidied data compared with raw</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>data_units <span class="op">=</span> ...</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ca_main_units <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-11-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="question-11-missing-values">Question 11: Missing values</h3>
<p>Gap estimates were not calculated for certain grades in certain districts due to small sample sizes (not enough individual tests recorded). Answer the following:</p>
<ul>
<li><ol type="i">
<li>What proportion of rows are missing for each of the reading and math gap variables? Store these values as <code>math_missing</code> and <code>reading_missing</code>, respectively.</li>
</ol></li>
<li><ol start="2" type="i">
<li>What proportion of <em>districts</em> (not rows!) have missing gap estimates for one or both test subjects for at least one grade level?Store the value as <code>district_missing</code>.</li>
</ol></li>
</ul>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of missing values</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>math_missing, reading_missing <span class="op">=</span> ...</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of districts with missing values</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
</section>
<section id="question-12-missing-mechanism" class="level3">
<h3 class="anchored" data-anchor-id="question-12-missing-mechanism">Question 12: Missing mechanism</h3>
<p>Do you expect that this missingness is more likely for some districts than for others? If so, explain; why is this, and is bias a concern if missing values are dropped?</p>
<p><em>Type your answer here, replacing this text.</em></p>
<!-- END QUESTION -->
</section>
</section>
<section id="exploratory-graphics" class="level1">
<h1>Exploratory graphics</h1>
<p>For the purpose of visualizing the relationship between estimated gender gaps and socioeconomic variables, you’ll find it more helpful to store a non-tidy version of the data. The cell below rearranges the dataset so that one column contains an estimated gap, one column contains the value of a socioeconomic variable, and the remaining columns record the gap type and variable identity.</p>
<p>Ensure that your results above match the reference dataset before running this cell.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># format data for plotting</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>plot_df <span class="op">=</span> seda_data.melt(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    id_vars <span class="op">=</span> name_order[<span class="dv">0</span>:<span class="dv">9</span>],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    value_vars <span class="op">=</span> [<span class="st">'Math gap'</span>, <span class="st">'Reading gap'</span>],</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> <span class="st">'Gap type'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    value_name <span class="op">=</span> <span class="st">'Gap'</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>).melt(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    id_vars <span class="op">=</span> [<span class="st">'District ID'</span>, <span class="st">'District'</span>, <span class="st">'Locale'</span>, <span class="st">'Gap type'</span>, <span class="st">'Gap'</span>, <span class="st">'Grade'</span>],</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    value_vars <span class="op">=</span> name_order[<span class="dv">3</span>:<span class="dv">8</span>],</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> <span class="st">'Socioeconomic variable'</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    value_name <span class="op">=</span> <span class="st">'Measure'</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plot_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="gender-gaps-and-socioeconomic-factors" class="level2">
<h2 class="anchored" data-anchor-id="gender-gaps-and-socioeconomic-factors">Gender gaps and socioeconomic factors</h2>
<p>The cell below generates a panel of scatterplots showing the relationship between estimated gender gap and socioeconomic factors for all grade levels by test subject. The plot suggests that the reading gap favors girls consistently across the socioeconomic spectrum – in a typical district girls seem to outperform boys by 0.25 standard deviations of the national average. By contrast, the math gap appears to depend on socioeconomic factors – boys only seem to outperform girls under <em>better</em> socioeconomic conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot gap against socioeconomic variables by subject for all grades</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> alt.Chart(plot_df).mark_circle(opacity <span class="op">=</span> <span class="fl">0.1</span>).encode(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'Gap'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> alt.X(<span class="st">'Measure'</span>, scale <span class="op">=</span> alt.Scale(zero <span class="op">=</span> <span class="va">False</span>), title <span class="op">=</span> <span class="st">''</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'Gap type'</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>).facet(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> alt.Column(<span class="st">'Socioeconomic variable'</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>).resolve_scale(x <span class="op">=</span> <span class="st">'independent'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>fig1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
<section id="question-13-relationships-by-grade-level" class="level3">
<h3 class="anchored" data-anchor-id="question-13-relationships-by-grade-level">Question 13: Relationships by grade level</h3>
<p>Does the pattern shown in the plot above persist within each grade level? Modify the plot above to show these relationships by grade level: generate a panel of scatterplots of gap against socioeconomic measures by subject, where each column of the panel corresponds to one socioeconomic variable and each row corresponds to one grade level; the result should by a 5x5 panel. Resize the width and height of each facet so that the panel is of reasonable size. Keep a fixed axis scale for the variable of interest, but allow the axis scales for socioeconomic variables to vary independently. Store the plot as <code>fig2</code>; display the figure and provide an answer to the question of interest in the text cell.</p>
<p>(<em>Hint</em>: you may find it useful to have a look at the <a href="https://altair-viz.github.io/user_guide/compound_charts.html">altair documentation on compound charts</a>, and lab 3, for examples to follow.)</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting codes here</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
<!-- BEGIN QUESTION -->
</section>
<section id="question-14-association-with-grade-level" class="level3">
<h3 class="anchored" data-anchor-id="question-14-association-with-grade-level">Question 14: Association with grade level</h3>
<p>Do gaps shift across grade levels? It’s not so easy to tell from the last figure. Construct a 2x5 panel of scatterplots showing estimated achievement gap against each of the 5 socioeconomic variables, with one row per test subject. Display grade level using a color gradient. Store the plot as <code>fig3</code>; display the figure and answer the question of interest in a short sentence or two in the text cell provided.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting codes here</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
<p>While the magnitude of the achievement gaps seems to depend very slightly on grade level (figure 3), the form of relationship between achievement gap and socioeconomic factors does not differ from grade to grade (figure 2).</p>
<p>Given that the relationships between achievement gaps and socioeconomic factors don’t change drastically across grade levels, it is reasonable to look at the average relationship between estimated achievement gap and median income after aggregating across grade.</p>
</section>
<section id="question-15-aggregation-across-grade-levels" class="level3">
<h3 class="anchored" data-anchor-id="question-15-aggregation-across-grade-levels">Question 15: Aggregation across grade levels</h3>
<p>Compute the mean estimated achievement gap in each subject across grade levels by district using <code>District ID</code> and retain the district-level socioeconomic variables. Store the resulting data frame as <code>seda_data_agg</code>.</p>
<p><em>Note</em>: best practice here would be to aggregate just the test scores by district and then re-merge the result with the district-level socioeconomic variables. However, since the district-level socioeconomic variables do not differ by grade within a district, averaging them across grade levels by district together with the test scores will simply return their unique values; so the aggregation can be applied across <em>all</em> columns for a fast-and-loose way to obtain the desired result.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate across grades</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print first few rows</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q15"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-16-melt-aggregated-data-for-plotting" class="level3">
<h3 class="anchored" data-anchor-id="question-16-melt-aggregated-data-for-plotting">Question 16: Melt aggregated data for plotting</h3>
<p>Similar to working with the disaggregated data, it will be helpful for plotting to melt the two gap variables into a single column. Follow the example above at the beginning of this section to melt <em>only the test score gap columns</em> (not the district-level variables – we will not create scatterplot panels as before). Name the new columns <code>Subject</code> and <code>Average estimated gap</code>; store the resulting data frame as <code>agg_plot_df</code> and print the first four rows.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># format for plotting</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print four rows</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q16"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
</section>
<section id="question-17-district-average-gaps" class="level3">
<h3 class="anchored" data-anchor-id="question-17-district-average-gaps">Question 17: District average gaps</h3>
<p>Construct a scatterplot of the average estimated gap against log(Median income) by subject for each district and add trend lines (see lab 4). Store the plot as <code>fig4</code>. Describe and interpret the plot in a few sentences.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># trend line</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>trend <span class="op">=</span> ...</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># combine layers</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>fig4 <span class="op">=</span> ...</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
<p>Now let’s try to capture this pattern in <em>tabular</em> form. The cell below adds an <code>Income bracket</code> variable by cutting the median income into 8 contiguous intervals using <code>pd.cut()</code>, and tabulates the average socioeconomic measures and estimated gaps across districts by income bracket. Notice that with respect to the gaps, this displays the pattern that is shown visually in the figures above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>seda_data_agg[<span class="st">'Income bracket'</span>] <span class="op">=</span> pd.cut(np.e<span class="op">**</span>seda_data_agg[<span class="st">'log(Median income)'</span>], <span class="dv">8</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>seda_data_agg.groupby(<span class="st">'Income bracket'</span>).mean().drop(columns <span class="op">=</span> [<span class="st">'District ID'</span>, <span class="st">'log(Median income)'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-18-proportion-of-districts-with-a-math-gap" class="level3">
<h3 class="anchored" data-anchor-id="question-18-proportion-of-districts-with-a-math-gap">Question 18: Proportion of districts with a math gap</h3>
<p>What proportion of districts in each income bracket have an average estimated math achievement gap favoring boys? Answer this question by performing the following steps:</p>
<ul>
<li>Append an indicator variable <code>Math gap favoring boys</code> to <code>seda_data_agg</code> that records whether the average estimated math gap favors boys by more than 0.1 standard deviations relative to the national average.</li>
<li>Compute the proportion of districts in each income bracket for which the indicator is true: group by bracket and take the mean. Store this as <code>income_bracket_boys_favored</code></li>
</ul>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define indicator</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>seda_data_agg[<span class="st">'Math gap favoring boys'</span>] <span class="op">=</span> ...</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of districts with gap favoring boys, by income bracket</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print result</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q18"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-19-statewide-averages" class="level3">
<h3 class="anchored" data-anchor-id="question-19-statewide-averages">Question 19: Statewide averages</h3>
<p>To wrap up the exploration, calculate a few statewide averages to get a sense of how some of the patterns above compare with the state as a whole.</p>
<ul>
<li><ol type="i">
<li>Compute the statewide average estimated achievement gaps. Store the result as <code>state_avg</code>.</li>
</ol></li>
<li><ol start="2" type="i">
<li>Compute the proportion of districts in the state with a math gap favoring boys. Store this result as <code>math_boys_proportion</code></li>
</ol></li>
<li><ol start="3" type="i">
<li>Compute the proportion of districts in the state with a math gap favoring girls. You will need to define a new indicator within <code>seda_data_agg</code> to perform this calculation.</li>
</ol></li>
</ul>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statewide average</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>state_avg <span class="op">=</span> ...</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of districts in the state with a math gap favoring boys</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>math_boys_proportion <span class="op">=</span> ...</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of districts in the state with a math gap favoring girls</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>seda_data_agg[<span class="st">'Math gap favoring girls'</span>] <span class="op">=</span> ...</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>math_girls_proportion <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q19"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="communicating-results" class="level1">
<h1>Communicating results</h1>
<p>Take a moment to review and reflect on your findings and consider what you have learned from the analysis.</p>
<!-- BEGIN QUESTION -->
<section id="question-20-summary" class="level3">
<h3 class="anchored" data-anchor-id="question-20-summary">Question 20: Summary</h3>
<p>Write a brief summary of your exploratory analysis. What have you discovered about educational achievement gaps in California school districts? Aim to answer in 3-5 sentences or less.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<!-- END QUESTION -->
</section>
</section>
<section id="submission" class="level1">
<h1>Submission</h1>
<ol type="1">
<li>Save the notebook.</li>
<li>Restart the kernel and run all cells. (<strong>CAUTION</strong>: if your notebook is not saved, you will lose your work.)</li>
<li>Carefully look through your notebook and verify that all computations execute correctly and all graphics are displayed clearly. You should see <strong>no errors</strong>; if there are any errors, make sure to correct them before you submit the notebook.</li>
<li>Download the notebook as an <code>.ipynb</code> file. This is your backup copy.</li>
<li>Export the notebook as PDF and upload to Gradescope.</li>
</ol>
<hr>
<p>To double-check your work, the cell below will rerun all of the autograder tests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>grader.check_all()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>