<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PSTAT100 - Background: diatoms and paleoclimatology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-H3YKZX4J88"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-H3YKZX4J88', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">PSTAT100</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Course syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../content.html" rel="" target="">
 <span class="menu-text">Materials</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#diatom-data" id="toc-diatom-data" class="nav-link active" data-scroll-target="#diatom-data">Diatom data</a>
  <ul class="collapse">
  <li><a href="#question-1-filling-nans" id="toc-question-1-filling-nans" class="nav-link" data-scroll-target="#question-1-filling-nans">Question 1: Filling NaNs</a></li>
  <li><a href="#question-2-counts-to-proportions" id="toc-question-2-counts-to-proportions" class="nav-link" data-scroll-target="#question-2-counts-to-proportions">Question 2: Counts to proportions</a></li>
  <li><a href="#question-3-time-span" id="toc-question-3-time-span" class="nav-link" data-scroll-target="#question-3-time-span">Question 3: Time span</a></li>
  <li><a href="#question-4-time-resolution" id="toc-question-4-time-resolution" class="nav-link" data-scroll-target="#question-4-time-resolution">Question 4: Time resolution</a></li>
  </ul></li>
  <li><a href="#univariate-explorations" id="toc-univariate-explorations" class="nav-link" data-scroll-target="#univariate-explorations">Univariate explorations</a>
  <ul class="collapse">
  <li><a href="#question-5-summary-statistics" id="toc-question-5-summary-statistics" class="nav-link" data-scroll-target="#question-5-summary-statistics">Question 5: Summary statistics</a></li>
  <li><a href="#question-6-visualizing-summary-statistics" id="toc-question-6-visualizing-summary-statistics" class="nav-link" data-scroll-target="#question-6-visualizing-summary-statistics">Question 6: Visualizing summary statistics</a></li>
  <li><a href="#question-7-distribution-of-azpeitia-nodulifer-abundance-over-time" id="toc-question-7-distribution-of-azpeitia-nodulifer-abundance-over-time" class="nav-link" data-scroll-target="#question-7-distribution-of-azpeitia-nodulifer-abundance-over-time">Question 7: Distribution of <em>Azpeitia nodulifer</em> abundance over time</a></li>
  <li><a href="#question-8-conditional-distributions-of-relative-abundance" id="toc-question-8-conditional-distributions-of-relative-abundance" class="nav-link" data-scroll-target="#question-8-conditional-distributions-of-relative-abundance">Question 8: Conditional distributions of relative abundance</a></li>
  </ul></li>
  <li><a href="#visualizing-community-composition-with-pca" id="toc-visualizing-community-composition-with-pca" class="nav-link" data-scroll-target="#visualizing-community-composition-with-pca">Visualizing community composition with PCA</a>
  <ul class="collapse">
  <li><a href="#question-9-pairwise-correlations-in-relative-abundances" id="toc-question-9-pairwise-correlations-in-relative-abundances" class="nav-link" data-scroll-target="#question-9-pairwise-correlations-in-relative-abundances">Question 9: Pairwise correlations in relative abundances</a></li>
  <li><a href="#question-10-computing-and-selecting-principal-components" id="toc-question-10-computing-and-selecting-principal-components" class="nav-link" data-scroll-target="#question-10-computing-and-selecting-principal-components">Question 10: Computing and selecting principal components</a></li>
  <li><a href="#question-11-interpreting-component-loadings" id="toc-question-11-interpreting-component-loadings" class="nav-link" data-scroll-target="#question-11-interpreting-component-loadings">Question 11: Interpreting component loadings</a></li>
  <li><a href="#question-12-visualizing-community-composition-shift" id="toc-question-12-visualizing-community-composition-shift" class="nav-link" data-scroll-target="#question-12-visualizing-community-composition-shift">Question 12: Visualizing community composition shift</a></li>
  <li><a href="#optional-question-13-multi-panel-visualization" id="toc-optional-question-13-multi-panel-visualization" class="nav-link" data-scroll-target="#optional-question-13-multi-panel-visualization">(Optional) Question 13: Multi-panel visualization</a></li>
  </ul></li>
  <li><a href="#communicating-results" id="toc-communicating-results" class="nav-link" data-scroll-target="#communicating-results">Communicating results</a>
  <ul class="collapse">
  <li><a href="#question-14-summary" id="toc-question-14-summary" class="nav-link" data-scroll-target="#question-14-summary">Question 14: Summary</a></li>
  <li><a href="#question-15-further-work" id="toc-question-15-further-work" class="nav-link" data-scroll-target="#question-15-further-work">Question 15: Further work</a></li>
  </ul></li>
  <li><a href="#submission" id="toc-submission" class="nav-link" data-scroll-target="#submission">Submission</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Background: diatoms and paleoclimatology</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Otter</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> otter</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>grader <span class="op">=</span> otter.Notebook(<span class="st">"hw3-diatom.ipynb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># disable row limit for plotting</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>alt.data_transformers.disable_max_rows()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment to ensure graphics display with pdf export</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># alt.renderers.enable('mimetype')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Diatoms are a type of phytoplankton – they are photosynthetic algae that function as primary producers in aquatic ecosystems. Diatoms are at the bottom of the food web: they are consumed by filter feeders, like clams, mussels, and many fish, which are in turn consumed by larger organisms like scavengers and predators and, well, us. As a result, changes in the composition of diatom species in marine ecosystems have ripple effects that can dramatically alter overall community structure in any environment of which marine life forms a part.</p>
<p>Diatoms have glass bodies. As a group of organisms, they display a great diversity of body shapes, and many are quite elaborate. The image below, taken from a Scientific American article, shows a small sample of their shapes and structures.</p>
<center>
<img src="figures/diatoms-sciam.jpg" style="width:400px">
</center>
<p>Because they are made of glass, diatoms preserve extraordinarily well over time. When they die, their bodies sink and form part of the sediment. Due to their abundance, there is a sort of steady rain of diatoms forming part of the sedimentation process, which produces sediment layers that are dense with diatoms.</p>
<p>Sedimentation is a long-term process spanning great stretches of time, and the deeper one looks in sediment, the older the material. Since diatoms are present in high density throughout sedimentation layers, and they preserve so well, it is possible to study their presence over longer time spans – potentially hundreds of thousands of years.</p>
<p>A branch of paleoclimatology is dedicated to studying changes in biological productivity on geologic time scales, and much research in this area has involved studying the relative abundances of diatoms. In this assignment, you’ll do just that on a small scale and work with data from sediment cores taken in the gulf of California at the location indicated on the map:</p>
<center>
<img src="figures/site1-barron2004.png" style="width:400px">
</center>
<p>The data is publicly available: &gt; Barron, J.A., <em>et al.</em> 2005. High Resolution Guaymas Basin Geochemical, Diatom, and Silicoflagellate Data. IGBP PAGES/World Data Center for Paleoclimatology Data Contribution Series # 2005-022. NOAA/NGDC Paleoclimatology Program, Boulder CO, USA.</p>
<p>In this assignment, you’ll use the exploratory techniques we’ve been discussing in class to analyze the relative abundances of diatom taxa over a time span of 15,000 years. This will involve practicing the following:</p>
<ul>
<li>data import and preprocessing</li>
<li>graphical techniques for visualizing distributions</li>
<li>multivariate analysis with PCA</li>
</ul>
<section id="diatom-data" class="level1">
<h1>Diatom data</h1>
<p>The data are diatom counts sampled from evenly-spaced depths in a sediment core from the gulf of California. In sediment cores, depth correlates with time before the present – deeper layers are older – and depths are typically chosen to obtain a desired temporal resolution. The counts were recorded by sampling material from sediment cores at each depth, and examining the sampled material for phytoplankton cells. For each sample, phytoplankton were identified at the taxon level and counts of diatom taxa were recorded along with the total number of phytoplankton cells identified. Thus:</p>
<ul>
<li>The <strong>observational units</strong> are <em><strong>sediment samples</strong></em>.<br>
</li>
<li>The <strong>variables</strong> are <em><strong>depth (age), diatom abundance counts, and the total number of identified phytoplankton</strong></em>. Age is inferred from radiocarbon.</li>
<li>One <strong>observation</strong> is made at <em><strong>each depth</strong></em> from 0cm (surface) to 13.71 cm.</li>
</ul>
<p>The table below provides variable descriptions and units for each column in the dataframe.</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Units</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Depth</td>
<td>Depth interval location of sampled material in sediment core</td>
<td>Centimeters (cm)</td>
</tr>
<tr class="even">
<td>Age</td>
<td>Radiocarbon age</td>
<td>Thousands of years before present (KyrBP)</td>
</tr>
<tr class="odd">
<td>A_curv</td>
<td>Abundance of <em>Actinocyclus curvatulus</em></td>
<td>Count (n)</td>
</tr>
<tr class="even">
<td>A_octon</td>
<td>Abundance of <em>Actinocyclus octonarius</em></td>
<td>Count (n)</td>
</tr>
<tr class="odd">
<td>ActinSpp</td>
<td>Abundance of <em>Actinoptychus</em> species</td>
<td>Count (n)</td>
</tr>
<tr class="even">
<td>A_nodul</td>
<td>Abundance of <em>Azpeitia nodulifer</em></td>
<td>Count (n)</td>
</tr>
<tr class="odd">
<td>CocsinSpp</td>
<td>Abundance of <em>Coscinodiscus</em> species</td>
<td>Count (n)</td>
</tr>
<tr class="even">
<td>CyclotSpp</td>
<td>Abundance of <em>Cyclotella</em> species</td>
<td>Count (n)</td>
</tr>
<tr class="odd">
<td>Rop_tess</td>
<td>Abundance of <em>Roperia tesselata</em></td>
<td>Count (n)</td>
</tr>
<tr class="even">
<td>StephanSpp</td>
<td>Abundance of <em>Stephanopyxis</em> species</td>
<td>Count (n)</td>
</tr>
<tr class="odd">
<td>Num.counted</td>
<td>Number of diatoms counted in sample</td>
<td>Count (n)</td>
</tr>
</tbody>
</table>
<p>The cell below imports the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import diatom data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>diatoms_raw <span class="op">=</span> pd.read_csv(<span class="st">'data/barron-diatoms.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>diatoms_raw.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data are already in tidy format, because each row is an observation (a set of measurements on one sample of sediment) and each column is a variable (one of age, depth, or counts). However, examine rows 3 and 4, and note:</p>
<ol type="1">
<li>NaNs are present</li>
<li>The number of individuals counted in each sample varies by a lot from sample to sample.</li>
</ol>
<p>Let’s address those before conducting initial explorations.</p>
<p>The NaNs are an artefact of the data recording – if <em>no</em> diatoms in a particular taxa are observed, a <code>-</code> is entered in the table (you can verify this by checking the .csv file). In these cases the value isn’t missing, but rather zero. These entries are parsed by pandas as NaNs, but they correspond to a value of 0 (no diatoms observed).</p>
<section id="question-1-filling-nans" class="level3">
<h3 class="anchored" data-anchor-id="question-1-filling-nans">Question 1: Filling NaNs</h3>
<p>Use <code>.fill_na()</code> to replace all NaNs by zeros, and store the result as <code>diatoms_mod1</code>. Store rows 4 and 5 (index, not integer location) of the resulting dataframe as <code>diatoms_mod1_examplerows</code> and display these rows.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>diatoms_mod1 <span class="op">=</span> ...</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print rows 4 and 5</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>diatoms_mod1_examplerows <span class="op">=</span> ...</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(diatoms_mod1_examplerows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since the total number of phytoplankton counted in each sample varies, the raw counts are not directly comparable – <em>e.g.</em>, a count of 18 is actually a <em>different</em> abundance in a sample with 200 individuals counted than in a sample with 300 individuals counted.</p>
<p>For exploratory analysis, you’ll want the values to be comparable across rows. This can be achieved by a simple transformation so that the values are <em>relative</em> abundances: <em>proportions</em> of phytoplankton observed from each taxon.</p>
</section>
<section id="question-2-counts-to-proportions" class="level3">
<h3 class="anchored" data-anchor-id="question-2-counts-to-proportions">Question 2: Counts to proportions</h3>
<p>Convert the counts to proportions by dividing by the relevant entry in the <code>Num.counted</code> column. There are a few ways to do this, but here’s one approach:</p>
<ol type="1">
<li>Set Depth and Age to row indices using <code>.set_index(...)</code> and store the result as <code>diatoms_mod2</code>.</li>
<li>Store the <code>Num.counted</code> column from <code>diatoms_mod2</code> as <code>sampsize</code>.</li>
<li>Use <code>.div(...)</code> to divide entrywise every column in <code>diatoms_mod2</code> by <code>sampsize</code> and store the result as <code>diatoms_mod3</code>.</li>
<li>Drop the <code>Num.counted</code> column from <code>diatoms_mod3</code> and reset the index; store the result as <code>diatoms</code>.</li>
</ol>
<p>Carry out these steps and print the first four rows of <code>diatoms</code>.</p>
<p>(<em>Hint</em>: careful with the <code>axis = ...</code> argument in <code>.div(...)</code>; you may want to look at the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.div.html">documentation</a> and check one or two values manually to verify the calculation works as intended.)</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set depth, age to indices</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>diatoms_mod2 <span class="op">=</span> ...</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># store sample sizes</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sampsize <span class="op">=</span> ...</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># divide</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>diatoms_mod3 <span class="op">=</span> ...</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># drop num.counted and reset index</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>diatoms <span class="op">=</span> ...</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take a moment to think about what the data represent. They are relative abundances over time; essentially, snapshots of the community composition of diatoms over time, and thus information about how ecological community composition changes.</p>
<p>Before diving in, it will be helpful to resolve two matters:</p>
<ol type="1">
<li>How far back in time do the data go?</li>
<li>What is the time resolution of the data?</li>
</ol>
</section>
<section id="question-3-time-span" class="level3">
<h3 class="anchored" data-anchor-id="question-3-time-span">Question 3: Time span</h3>
<p>What is the geological time span covered by the data? Compute the minimum and maximum age using <code>.aggregate(...)</code> and store the result as <code>min_max_age</code>. (You will need to use <code>.aggregate()</code> to pass the automated tests.)</p>
<p><em>Note</em>: This may be a new function for you, but it’s simple: it takes as an argument a list of functions that will be applied to the dataframe (columnwise by default). So for example, to get the mean and variance of each column in <code>df</code>, one would use <code>df.aggregate(['mean', 'var'])</code>. See the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.aggregate.html">documentation</a> for further examples.</p>
<p><em>Remember</em>: age is reported as thousands of years before present, so <code>Age = 2</code> means 2000 years ago.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>min_max_age <span class="op">=</span> ...</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>min_max_age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
</section>
<section id="question-4-time-resolution" class="level3">
<h3 class="anchored" data-anchor-id="question-4-time-resolution">Question 4: Time resolution</h3>
<p><strong>(i) How are the observations spaced in time?</strong></p>
<p>Follow these steps:</p>
<ol type="1">
<li>Extract the <code>Age</code> column from <code>diatoms</code>, sort the values in ascending order, compute the differences between consecutive rows, and store the result as <code>diffs</code>.
<ul>
<li><em>Hint</em>: use <code>.sort_values()</code> and <code>.diff()</code>.</li>
<li><em>Notice</em>: that the first difference is NaN, because there is no previous value to compare the first row with. Drop this entry when you store <code>diffs</code>.</li>
</ul></li>
<li>Make a simple count histogram (no need to manually bin or convert to density scale) with bins of width 0.02 (20 years). Store this as <code>fig1</code> and display the figure.
<ul>
<li>Label the x axis ‘Time step between consecutive samples’</li>
<li>Put the y axis on a square root scale so that bins with one observation are discernible</li>
</ul></li>
</ol>
<p><strong>(ii) What is the typical time step in years?</strong></p>
<p>Write your answer based on the count histogram.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store differences</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>diffs <span class="op">=</span> ...</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># construct histogram</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> alt.Chart(diffs).mark_bar().encode(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> ...</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ...</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>fig1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
</section>
</section>
<section id="univariate-explorations" class="level1">
<h1>Univariate explorations</h1>
<p>To begin, you’ll examine the variation in relative abundance over time for the eight individual taxa, one variable at a time.</p>
<p>Here are some initial questions in this spirit that will help you to hone in and develop more focuesed exploratory questions: * Which taxa are most and least abundant on average over time? * Which taxa vary the most over time?</p>
<p>These can be answered by computing simple summary statistics for each column in the diatom data.</p>
<section id="question-5-summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="question-5-summary-statistics">Question 5: Summary statistics</h3>
<p>Use <code>.aggregate(...)</code> to find the mean and standard deviation of relative abundances for each taxon. Follow these steps:</p>
<ol type="1">
<li>Drop the depth and age variables before performing the aggregation.</li>
<li>Use <code>.transpose()</code> to ensure that the table is rendered in long form (8 rows by 2 columns rather than 2 columns by 8 rows).</li>
<li>Store the resulting dataframe as <code>diatom_summary</code> display.</li>
</ol>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>diatom_summary <span class="op">=</span> ...</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print the dataframe</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>diatom_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It will be easier to determine which taxa are most/least abundant and most variable by displaying this information visually.</p>
<!-- BEGIN QUESTION -->
</section>
<section id="question-6-visualizing-summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="question-6-visualizing-summary-statistics">Question 6: Visualizing summary statistics</h3>
<p><strong>(i) Create a plot of the average relative abundances and their variation over time.</strong></p>
<ol type="1">
<li>Reset the index of <code>diatom_summary</code> so that the taxon names are stored as a column and not an index. Store the result as <code>plot_df</code>.</li>
<li>Create an Altair chart based on <code>plot_df</code> with <em>no marks</em> – just <code>alt.Chart(...).encode(...)</code> – and pass the columnn of taxon names to the <code>Y</code> encoding channel with the title ‘Taxon’ and sorted in descending order of mean relative abundance. Store the result as <code>base</code>.
<ul>
<li><em>Hint</em>: <code>alt.Y(..., sort = {'field': 'column', 'order': 'descending'})</code> will sort the Y channel by ‘column’ in descending order.</li>
</ul></li>
<li>Modify <code>base</code> to create a point plot of the average relative abundances for each taxon; store the result as <code>means</code>.
<ul>
<li>Average relative abundance (the mean you calculated in Q1 (a)) should appear on the x axis, and taxon on the y axis.</li>
<li>Since the <code>Y</code> encoding was already specified in <code>base</code>, you do not need to add a <code>Y</code> encoding at this stage.</li>
<li>Give the x axis the title ‘Average relative abundance’.</li>
</ul></li>
<li>Modify <code>base</code> to create a plot with bars spanning two standard deviations in either direction from the mean. Store the result as <code>bars</code>.
<ul>
<li>First use <code>base.transform_calculate(...)</code> to compute <code>lwr</code> and <code>upr</code> for the positions of the bar endpoints:
<ul>
<li><span class="math inline">\(\texttt{lwr} = \texttt{mean} - 2\times\texttt{std}\)</span></li>
<li><span class="math inline">\(\texttt{upr} = \texttt{mean} + 2\times\texttt{std}\)</span>.</li>
</ul></li>
<li>Then append <code>.mark_errorbar().encode(...)</code> to the chain:
<ul>
<li>pass <code>lwr:Q</code> to the <code>X</code> encoding channel with the title ‘Average relative abundance’ (to match the point plot)</li>
<li>pass <code>upr:Q</code> to the <code>X2</code> encoding channel (no specific title needed).</li>
</ul></li>
</ul></li>
<li>Layer the plots: <code>means + bars</code>. Store the result as <code>fig2</code> and display the figure.</li>
</ol>
<p>It may help to have a look at <a href="https://altair-viz.github.io/gallery/simple_scatter_with_errorbars.html">this example</a>.</p>
<p><strong>(ii) Based on the figure, answer the following questions.</strong></p>
<ol type="1">
<li>Which taxon is most abundant on average over time?</li>
<li>Which taxon is most rare on average over time?</li>
<li>Which taxon varies most in relative abundance over time?</li>
</ol>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset index</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plot_df <span class="op">=</span> ...</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create base chart</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> alt.Chart(plot_df).encode(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ...</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create point plot</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> base.mark_point().encode(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> ...</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create bar plot</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> base.transform_calculate(</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    lwr <span class="op">=</span> ...</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    upr <span class="op">=</span> ...</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>).mark_errorbar().encode(</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> ...</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> ...</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># layer</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> ...</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>fig2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
<p>Now that you have a sense of the typical abundances for each taxon (measured by means) and the variations in abundance (measured by standard deviations), you’ll dig in a bit further and examine the variation in abundance of the most variable taxon.</p>
<!-- BEGIN QUESTION -->
</section>
<section id="question-7-distribution-of-azpeitia-nodulifer-abundance-over-time" class="level3">
<h3 class="anchored" data-anchor-id="question-7-distribution-of-azpeitia-nodulifer-abundance-over-time">Question 7: Distribution of <em>Azpeitia nodulifer</em> abundance over time</h3>
<p><strong>(i) Construct a density scale histogram of the relative abundances of <em>Azpeitia nodulifer</em> and overlay a kernel density estimate.</strong></p>
<p>Use the <code>diatoms</code> dataframe and a bin width of 0.03. Be sure to choose an appropriate kernel and smoothing bandwidth. Store the result as <code>fig3</code>.</p>
<p><strong>(ii) Answer the following questions in a few sentences.</strong></p>
<ul>
<li>Which values are common?</li>
<li>Which values are rare?</li>
<li>How spread out are the values?</li>
<li>Are values spread evenly or irregularly?</li>
</ul>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density scale histogram</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> alt.Chart(diatoms).transform_bin(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    as_ <span class="op">=</span> ...</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    field <span class="op">=</span> ...</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">bin</span> <span class="op">=</span> ...</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>).transform_aggregate(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    Count <span class="op">=</span> ...</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    groupby <span class="op">=</span> ...</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>).transform_calculate(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    Density <span class="op">=</span> ...</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    binshift <span class="op">=</span> ...</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>).mark_bar(size <span class="op">=</span> <span class="dv">25</span>, opacity <span class="op">=</span> <span class="fl">0.8</span>).encode(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> ...</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ...</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># compute density estimate</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot kde</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>smooth <span class="op">=</span> ...</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># layer</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>fig3 <span class="op">=</span> ...</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>fig3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
<blockquote class="blockquote">
<p><strong>Comment:</strong> There are a disproportionately large number of zeroes, because in many samples no <em>Azpeitia nodulifer</em> diatoms were observed. This is a common phenomenon in ecological data, and even has a name: it results in a ‘zero inflated’ distribution of values. The statistician to identify and name the phenomenon was Diane Lambert in 1992. Zero inflation can present a variety of challenges. You may have noticed, for example, that there was no bandwidth parameter for the KDE that <em>both</em> captured the shape of the histogram near zero <em>and</em> away from zero, regardless of the choice of kernel. The key difficulty with zero inflated data is that no common probability distribution fits the data well. This requires the use of mixtures as probability models, which are challenging to incorporate into common statistical models.</p>
</blockquote>
<p>There was a transition between geological epochs during the time span covered by the diatom data. The oldest data points in the diatom data correspond to the end of the Pleistocene epoch (ice age), at which time there was a pronounced warming (Late Glacial Interstadial, 14.7 - 12.9 KyrBP) followed by a return to glacial conditions (Younger Dryas, 12.9 - 11.7 KyrBP).</p>
<p>This fluctuation can be seen from temperature reconstructions. Below is a plot of sea surface temperature reconstructions off the coast of Northern California. Data come from the following source:</p>
<blockquote class="blockquote">
<p>Barron <em>et al.</em>, 2003. Northern Coastal California High Resolution Holocene/Late Pleistocene Oceanographic Data. IGBP PAGES/World Data Center for Paleoclimatology. Data Contribution Series # 2003-014. NOAA/NGDC Paleoclimatology Program, Boulder CO, USA.</p>
</blockquote>
<p>The shaded region indicates the time window with unusually large flucutations in sea surface temperature; this window roughly corresponds to the dates of the climate event.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import sea surface temp reconstruction</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>seatemps <span class="op">=</span> pd.read_csv(<span class="st">'data/barron-sst.csv'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># line plot of time series</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> alt.Chart(seatemps).mark_line().encode(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> alt.X(<span class="st">'Age'</span>, title <span class="op">=</span> <span class="st">'Thousands of years before present'</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'SST'</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight region with large variations</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>highlight <span class="op">=</span> alt.Chart(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'SST'</span>: np.linspace(<span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">100</span>), </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">'upr'</span>: np.repeat(<span class="dv">11</span>, <span class="dv">100</span>), </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">'lwr'</span>: np.repeat(<span class="dv">15</span>, <span class="dv">100</span>)}</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>).mark_area(opacity <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">'orange'</span>).encode(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'SST'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> alt.X(<span class="st">'upr'</span>, title <span class="op">=</span> <span class="st">'Thousands of years before present'</span>),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> <span class="st">'lwr'</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add smooth trend</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>smooth <span class="op">=</span> line.transform_loess(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    on <span class="op">=</span> <span class="st">'Age'</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    loess <span class="op">=</span> <span class="st">'SST'</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    bandwidth <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>).mark_line(color <span class="op">=</span> <span class="st">'black'</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># layer</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>line <span class="op">+</span> highlight <span class="op">+</span> smooth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
</section>
<section id="question-8-conditional-distributions-of-relative-abundance" class="level3">
<h3 class="anchored" data-anchor-id="question-8-conditional-distributions-of-relative-abundance">Question 8: Conditional distributions of relative abundance</h3>
<p>Does the distribution of relative abundance of <em>Azpeitia nodulifer</em> differ when variation in sea temperatures was higher (before 11KyrBP)?</p>
<p><strong>(i) Plot kernel density estimates to show the distribution of relative abundances before and after 11KyrBP.</strong></p>
<p>Use the Altair implementation of Gaussian KDE: 1. Use <code>.transform_caluculate(...)</code> to calculate an indicator variable, <code>pleistocene</code>, that indicates whether <code>Age</code> exceeds 11. 2. Use <code>.transform_density(...)</code> to compute KDEs separately for observations of relative abundance before and after 11KyrBP. + <em>Hint</em>: group by <code>pleistocene</code> 3. Plot the KDEs distinguished by color; give the color legend the title ‘Before 11KyrBP’ and store the plot as <code>kdes</code>. 4. Add a shaded area beneath the KDE curves. Adjust the opacity of the area to your liking.</p>
<p>Store the result as <code>fig4</code> and display the figure.</p>
<p><strong>(ii) Does the distribution seem to change between epochs? If so, how?</strong></p>
<p>Answer based on the figure in a few sentences.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
</section>
</section>
<section id="visualizing-community-composition-with-pca" class="level1">
<h1>Visualizing community composition with PCA</h1>
<p>So far you’ve seen that the abundances of one taxon – <em>Azpeitia nodulifer</em> – change markedly before and after a shift in climate conditions. In this part you’ll use PCA to compare variation in community composition among <em>all</em> eight taxa during the late Pleistocene and Holocene epochs.</p>
<section id="question-9-pairwise-correlations-in-relative-abundances" class="level3">
<h3 class="anchored" data-anchor-id="question-9-pairwise-correlations-in-relative-abundances">Question 9: Pairwise correlations in relative abundances</h3>
<p><strong>(i) Compute the pairwise correlations between relative abundances and make a heatmap of the correlation matrix.</strong></p>
<p>Be sure to remove or set to indices the Depth and Age variables before computing the correlation matrix. Save the matrix as <code>corr_mx</code>.</p>
<ol type="1">
<li>Melt <code>corr_mx</code> to obtain a dataframe with three columns:
<ul>
<li><code>row</code>, which contains the values of the index of <code>corr_mx</code> (taxon names);</li>
<li><code>column</code>, which contains the names of the columns of <code>corr_mx</code> (also taxon names); and</li>
<li><code>Correlation</code>, which contains the values of <code>corr_mx</code>.</li>
<li>Store the result as <code>corr_mx_long</code>.</li>
</ul></li>
<li>Create an Altair chart based on <code>corr_mx_long</code> and construct the heatmap by following the examples indicated above.
<ul>
<li>Adjust the color scheme to <code>blueorange</code> over the extent (-1, 1) to obtain a diverging color gradient where a correlation of zero is blank (white).</li>
<li>Adjust the color legend to indicate the color values corresponding to correlations of 1, 0.5, 0, -0.5, and -1.</li>
<li>Sort the rows and columns in ascending order of correlation.</li>
</ul></li>
</ol>
<p><strong>(ii) How does <em>A. nodulifer</em> seem to vary with the other taxa, if at all?</strong></p>
<p>Answer in a few sentences based on the heatmap.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>corr_mx <span class="op">=</span> ...</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># melt corr_mx</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># construct heatmap</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>fig5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q9"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-10-computing-and-selecting-principal-components" class="level3">
<h3 class="anchored" data-anchor-id="question-10-computing-and-selecting-principal-components">Question 10: Computing and selecting principal components</h3>
<p>Here you’ll perform all of the calculations involved in PCA and check the variance ratios to select an appropriate number of principal components. The parts of this question correspond to the individual steps in this process.</p>
<p><strong>(i) Center and scale the data columns.</strong></p>
<p>For PCA it is usually recommended to center and scale the data; set Depth and Age as indices and center and scale the relative abundances. Store the normalized result as <code>pcdata</code>.</p>
<p><strong>(ii) Compute the principal components.</strong></p>
<p>Compute <em>all 8</em> principal components. For this part you do not need to show any specific output.</p>
<p><strong>(iii) Examine the variance ratios.</strong></p>
<p>Create a dataframe called <code>pcvars</code> with the variance information by following these steps:</p>
<ol type="1">
<li>Store the proportion of variance explained (called <code>.explained_variance_ratio_</code> in the PCA output) as a dataframe named <code>pcvars</code> with just one column named <code>Proportion of variance explained</code>.</li>
<li>Add a column named <code>Component</code> to <code>pcvars</code> with the integers 1 through 8 as values (indicating the component number).</li>
<li>Add a column named <code>Cumulative variance explained</code> to <code>pcvars</code> that is the cumulative sum of <code>Proportion of variance explained</code>.
<ul>
<li><em>Hint</em>: slice the <code>Proportion of variance explained</code> column and use <code>.cumsum(axis = ...)</code>.</li>
</ul></li>
</ol>
<p>For this part you do not need to show any specific output.</p>
<p><strong>(iv) Plot the variance explained by each PC.</strong></p>
<p>Use <code>pcvars</code> to construct a dual-axis plot showing the proportion of variance explained (left y axis) and cumulative variance explained (right y axis) as a function of component number (x axis), with points indicating the variance ratios and lines connecting the points. Follow these steps:</p>
<ol type="1">
<li>Construct a base chart that encodes only <code>Component</code> on the <code>X</code> channel. Store this as <code>base</code>.</li>
<li>Make a base layer for the proportion of variance explained that modifies <code>base</code> by encoding <code>Proportion of variance explained</code> on the <code>Y</code> channel. Store the result as <code>prop_var_base</code>.
<ul>
<li>Give the <code>Y</code> axis title a distinct color of your choosing via <code>alt.Y(..., axis = alt.Axis(titleColor = ...))</code>.</li>
</ul></li>
<li>Make a base layer for the cumulative variance explained that modifies <code>base</code> by endocing <code>Cumulative variance explained</code> on the <code>Y</code> channel. Store the result as <code>cum_var_base</code>.
<ul>
<li>Give the <code>Y</code> axis title another distinct color of your choosing via <code>alt.Y(..., axis = alt.Axis(titleColor = ...))</code>.</li>
</ul></li>
<li>Create a plot layer for the proportion of variance explained by combining points (<code>prop_var_base.mark_point()</code>) with lines (<code>prop_var_base.mark_line()</code>). Store the result as <code>cum_var</code>.
<ul>
<li>Apply the color you chose for the axis title to the points and lines.</li>
</ul></li>
<li>Repeat the previous step for the cumulative variance explained.
<ul>
<li>Apply the color you chose for the axis title to the points and lines.</li>
</ul></li>
<li>Layer the plots together using <code>alt.layer(l1, l2).resolve_scale(y = 'independent')</code>.</li>
</ol>
<p>Store the result as <code>fig6</code> and display the figure.</p>
<p><strong>(v) How many PCs should be used?</strong></p>
<p>Propose an answer based on the variance explained plots and indicate how much total variation your proposed number of components capture jointly.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (i) center and scale data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># helper variable pcdata_raw; set Depth and Age as indices</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>pcdata_raw <span class="op">=</span> ...</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># center and scale the relative abundances</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>pcdata <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (ii) compute pcs</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> ...</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (iii) retrieve variance info</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># store proportion of variance explained as a dataframe</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>pcvars <span class="op">=</span> ...</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add component number as a new column</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>pcvars[<span class="st">'Component'</span>] <span class="op">=</span> ...</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># add cumulative variance explained as a new column</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>pcvars[<span class="st">'Cumulative variance explained'</span>] <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (iv) plot variance explained</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># encode component axis only as base layer</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> ...</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make a base layer for the proportion of variance explained</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># make a base layer for the cumulative variance explained</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># add points and lines to each base layer</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># layer the layers</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>fig6 <span class="op">=</span> ...</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>fig6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that you’ve performed the calculations for PCA, you can move on to the fun/difficult part: figuring out what they say about the data.</p>
<p>The first step in this process is to examine the loadings. Each principal component is a linear combination of the relative abundances by taxon, and the loadings tell you <em>how</em> that combination is formed; the loadings are the linear combination coefficients, and thus correspond to the weight of each taxon in the corresponding principal component. Some useful points to keep in mind:</p>
<ul>
<li>a high loading value (negative or positive) indicates that a variable strongly influences the principal component;</li>
<li>a negative loading value indicates that
<ul>
<li>increases in the value of a variable <em>decrease</em> the value of the principal component</li>
<li>and decreases in the value of a variable <em>increase</em> the value of the principal component;</li>
</ul></li>
<li>a positive loading value indicates that
<ul>
<li>increases in the value of a variable <em>increase</em> the value of the principal component</li>
<li>and decreases in the value of a variable <em>decrease</em> the value of the principal component;</li>
</ul></li>
<li>similar loadings between two or more variables indicate that the principal component reflects their <em>average</em>;</li>
<li>divergent loadings between two sets of variables indicates that the principal component reflects their <em>difference</em>.</li>
</ul>
</section>
<section id="question-11-interpreting-component-loadings" class="level3">
<h3 class="anchored" data-anchor-id="question-11-interpreting-component-loadings">Question 11: Interpreting component loadings</h3>
<p><strong>(i) Extract the loadings from <code>pca</code>.</strong></p>
<p>Store the loadings for the first two principal components (called <code>.components_</code> in the PCA output) in a dataframe named <code>loading_df</code>. Name the columns <code>PC1</code> and <code>PC2</code>, and append a column <code>Taxon</code> with the corresponding variable names, and print the resulting dataframe.</p>
<p><strong>(ii) Construct loading plots</strong></p>
<p>Construct a line-and-point plot connecting the loadings of the first two principal components. Display the value of the loading on the y axis and the taxa names on the x axis, and show points indicating the loading values. Distinguish the PC’s by color, and add lines connecting the loading values for each principal component. Store the result as <code>fig7</code> and display the figure – you may need to resize for better readability.</p>
<p><em>Hint</em>: you will need to first melt <code>loading_df</code> to long form with three columns – the taxon name, the principal component (1 or 2), and the value of the loading.</p>
<p><strong>(iii) Interpret the first principal component.</strong></p>
<p>In a few sentences, answer the following questions. 1. Which taxa are up-weighted and which are down-weighted in this component? 2. How would you describe the principal component in context (<em>e.g.</em>, average abundance among a group, differences in abundances, etc.)? 3. How would you interpret a larger value of the PC versus a smaller value of the PC in terms of diatom communnity composition?</p>
<p><strong>(iv) Interpret the second principal component.</strong></p>
<p>Answer the same questions for component 2.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (i) retrieve loadings</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># store the loadings as a data frame with appropriate names</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>loading_df <span class="op">=</span> ...</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add a column with the taxon names</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>loading_df[<span class="st">'Taxon'</span>] <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (ii) construct loading plots</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># melt from wide to long</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>loading_plot_df <span class="op">=</span> loading_df.melt(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    id_vars <span class="op">=</span> ...</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> ...</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    value_name <span class="op">=</span> ...</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create base layer with encoding</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> alt.Chart(loading_plot_df).encode(</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> ...</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ...</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> ...</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># store horizontal line at zero</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>rule <span class="op">=</span> ...</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># layer points + lines + rule to construct loading plot</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>fig7 <span class="op">=</span> ...</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># show</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall that there was a shift in climate around 11,000 years ago, and <em>A. nodulifer</em> abundances seemed to differ before and after the shift.</p>
<p>You can now use PCA to investigate whether not just individual abundances but <em>community composition</em> may have shifted around that time. To that end, let’s think of the principal components as ‘community composition indices’:</p>
<ul>
<li>consider PC1 a nodulifer/non-nodulifer community composition index; and</li>
<li>consider PC2 a complex community composition index.</li>
</ul>
<p>A pattern of variation or covariation in the principal components can be thought of as reflecting a particular ecological community composition dynamic – a way that community composition varies throughout time. Here you’ll look for distinct patterns of variation/covariation before and after 11,000 years ago via an exploratory plot of the principal components.</p>
</section>
<section id="question-12-visualizing-community-composition-shift" class="level3">
<h3 class="anchored" data-anchor-id="question-12-visualizing-community-composition-shift">Question 12: Visualizing community composition shift</h3>
<p><strong>(i) Project the centered and scaled data onto the first two component directions.</strong></p>
<p>This sounds a little more complicated than it is – all that means is compute the values of the principal components for each data point. Create a dataframe called <code>projected_data</code> containing just the first two principal components as two columns named <code>PC1</code> and <code>PC2</code>, and two additional columns with the Age and Depth variables.</p>
<p><strong>(ii) Construct a scatterplot of PC1 and PC2 by epoch.</strong></p>
<p>Construct a scatterplot of the principal components with observations colored according to whether they occurred in the Pleistocene or Holocene epoch. Store the result as <code>fig8</code> and display the figure.</p>
<p><strong>(iii) Comment on the plot: does there appear to be any change in community structure?</strong></p>
<p>Answer in a few sentences.</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (i) project pcdata onto first two components; store as data frame</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve principal component scores for pc1 and pc2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>projected_data <span class="op">=</span> ...</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust index</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>projected_data.index <span class="op">=</span> ...</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>projected_data <span class="op">=</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">## (ii) construct scatterplot</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>grader.check(<span class="st">"q12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- BEGIN QUESTION -->
</section>
<section id="optional-question-13-multi-panel-visualization" class="level3">
<h3 class="anchored" data-anchor-id="optional-question-13-multi-panel-visualization">(Optional) Question 13: Multi-panel visualization</h3>
<p>Sometimes it’s helpful to see marginal distributions together with a scatterplot. Follow the steps below to create a multi-panel figure with marginal density estimates appended to the projected scatter from the previous question.</p>
<ol type="1">
<li>Create an Altair chart based on <code>projected_data</code> and use <code>.transform_calculate(...)</code> to define a variable <code>holocene</code> that indicates whether <code>Age</code> is older than 11,000 years. Store the result as <code>base</code>.</li>
<li>Modify <code>base</code> to add points with the following encodings.
<ul>
<li>Pass PC1 to the <code>X</code> encoding channel and title the axis ‘A. Nodulifer/non-A. nodulifer composition’.</li>
<li>Pass PC2 to the <code>Y</code> encoding channel and title the axis ‘Complex community composition’.</li>
<li>Pass the variable you created in step 1. to the <code>color</code> encoding channel and title it ‘Holocene’. Store the result as <code>scatter</code>.</li>
</ul></li>
<li>Construct plots of kernel density estimates for each principal component conditional on age being older than 11,000 years:
<ul>
<li>modify <code>base</code> to create a <code>top_panel</code> plot with the KDE curves for PC1, with color corresponding to the age indicator from the <code>.transform_calculate(...)</code> step in making the base layer;</li>
<li>modify <code>base</code> again to create a <code>side_panel</code> plot with the KDE curves for PC2, rotated 90 degrees relative to the usual orientation (flip the typical axes), and with color corresponding to the age indicator from the <code>.transform_calculate(...)</code> step in making the base layer.</li>
</ul></li>
<li>Then, resize these panels appropriately (top should be thin, side should be narrow), and use Altair’s faceting operators <code>&amp;</code> (vertical concatenation) and <code>|</code> (horizontal concatenation) to combine them with your scatterplot.</li>
</ol>
<p>Store the result as <code>fig9</code> and display the figure.</p>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make base layer</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># data scatter</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># construct side panel (kdes for pc2)</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># facet</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>fig9 <span class="op">=</span> ...</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>fig9</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- END QUESTION -->
</section>
</section>
<section id="communicating-results" class="level1">
<h1>Communicating results</h1>
<p>Take a moment to review and reflect on the results of your analysis in the previous parts. Think about how you would describe succinctly what you’ve learned from the diatom data.</p>
<!-- BEGIN QUESTION -->
<section id="question-14-summary" class="level3">
<h3 class="anchored" data-anchor-id="question-14-summary">Question 14: Summary</h3>
<p>Write a brief paragraph (3-5 sentences) that addresses the following questions by referring to your results above.</p>
<ul>
<li>How would you characterize the typical ecological community composition of diatom taxa before and after 11,000 years ago?
<ul>
<li><em>Hint</em>: focus on the side and top panels and the typical values of each index in the two time periods.</li>
</ul></li>
<li>Does the variation in ecological community composition over time seem to differ before and after 11,000 years ago?
<ul>
<li><em>Hint</em>: focus on the shape of data scatter.</li>
</ul></li>
</ul>
<p><em>Type your answer here, replacing this text.</em></p>
<!-- END QUESTION -->
<!-- BEGIN QUESTION -->
</section>
<section id="question-15-further-work" class="level3">
<h3 class="anchored" data-anchor-id="question-15-further-work">Question 15: Further work</h3>
<p>What more might you like to know, given what you’ve learned? Pose a question that your exploratory analysis raises for you.</p>
<section id="answer" class="level4">
<h4 class="anchored" data-anchor-id="answer">Answer</h4>
<p><em>Type your answer here.</em></p>
<!-- END QUESTION -->
</section>
</section>
</section>
<section id="submission" class="level1">
<h1>Submission</h1>
<ol type="1">
<li>Save the notebook.</li>
<li>Restart the kernel and run all cells. (<strong>CAUTION</strong>: if your notebook is not saved, you will lose your work.)</li>
<li>Carefully look through your notebook and verify that all computations execute correctly and all graphics are displayed clearly. You should see <strong>no errors</strong>; if there are any errors, make sure to correct them before you submit the notebook.</li>
<li>Download the notebook as an <code>.ipynb</code> file. This is your backup copy.</li>
<li>Export the notebook as PDF and upload to Gradescope.</li>
</ol>
<hr>
<p>To double-check your work, the cell below will rerun all of the autograder tests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>grader.check_all()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>